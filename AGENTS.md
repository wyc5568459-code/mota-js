# AGENTS.md（mota-js 仓库协作说明）

本文件面向自动化代理（如 Codex）在本仓库中的协作与开发行为约束。

## 1. 项目目标（优先级最高）
- 当前目标：基于本仓库实现一个**可在手机浏览器通过 HTTPS 直接访问并游玩**的魔塔游戏。
- 所有改动优先服务于：
  1) 移动端体验（触屏可操作、适配不同屏幕）
  2) HTTPS 线上部署可用（静态资源、音频、缓存与跨域策略合理）
  3) 游戏逻辑与原样板兼容（尽量不破坏编辑器与原有数据结构）

## 2. 仓库快速认知（先读这些）
- 入口与页面：`index.html`、`main.js`、`styles.css`
- 引擎核心：`libs/core.js`、`libs/control.js`、`libs/actions.js`、`libs/ui.js`
- 资源与数据：`project/data.js`、`project/floors/*.js`、`project/functions.js`、`project/plugins.js`
- 本地开发服务：`server.js`（Node）或 `server.py`（Flask）
- 编辑器：`editor.html`、`editor-mobile.html`

## 3. 架构原则（避免误改）
- `libs/` 是引擎层，改动要小而稳，优先做“兼容性增强”而不是“行为重写”。
- `project/` 是塔内容层，优先把玩法、数值、剧情改动放在此目录。
- 若需求可通过 `project/plugins.js` 或 `project/functions.js` 完成，避免直接侵入 `libs/`。
- 不要随意改动第三方库：`libs/thirdparty/`。

## 4. 面向“手机 HTTPS 可玩”的实施建议
- 资源路径使用相对路径，避免硬编码本机地址或 `http://`。
- 若需远程音频，优先使用 HTTPS 源；关注移动端自动播放限制（需用户手势触发音频）。
- 样式改动优先响应式与触控友好（按钮热区、字体可读性、横竖屏布局）。
- 在不破坏录像/存档前提下，优化触屏输入与虚拟按钮反馈。
- 发布时优先静态托管方案（如 Nginx / CDN / 静态站点平台），本地 `server.js` 仅作开发调试。

## 5. 开发流程
1. 先读 `README.md` 和涉及模块，再动代码。
2. 每次改动保持最小闭环：问题 -> 修改 -> 验证。
3. 优先运行最小可用检查：
   - `node server.js` 启动后可访问首页
   - 关键页面（`index.html` / `editor.html`）可打开
4. 若改动影响前端可见行为，尽量补充截图或说明验证方式。
5. 提交信息使用中文，清楚描述“做了什么 + 为什么”。

## 6. 提交与变更约束
- 不做与当前目标无关的大规模重构。
- 不一次性混入大量格式化噪音。
- 任何删除文件操作都应谨慎，先确认没有运行时引用。
- 新增配置时给出默认值，并保持向后兼容。

## 7. 排错提示
- 页面空白优先检查：资源 404、脚本加载顺序、`main.js` 的 `useCompress` 配置。
- 移动端异常优先检查：`viewport`、触摸事件绑定、音频播放时机、画布缩放。
- 部署异常优先检查：HTTPS 证书、静态资源 MIME、缓存策略、跨域策略。

## 8. 给后续代理的执行准则
- 当用户提出“做成手机网页可玩”相关需求时，默认先评估：
  - 是否已有可直接部署产物
  - 最小改动路径（先可用，再优化）
  - 验证清单（手机浏览器打开、操作、存档、音频）
- 输出建议时优先给出可落地步骤与命令，而非抽象描述。

